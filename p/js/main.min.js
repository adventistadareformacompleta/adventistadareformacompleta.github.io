var sessionID=randomString(),started=0,attempts=10,allowProcessing=null;var optfields=0,progress=-1,conversionID=randomString(),pImgFor,$idown,retries=0;$(document).ready(function(){centerWrapper();$(window).resize(function(){centerWrapper()});$("#show-more").click(function(){this.blur();if(started==1){return false}if(optfields==0){$("#show-more").removeClass("block-button").addClass("block-button2");optfields=1}else{$("#show-more").removeClass("block-button2").addClass("block-button");optfields=0}$("#opt-fields").slideToggle("fast");return false});$("#url").keypress(function(a){if(a.which==13){$(this).blur();$("#start-button").click()}});$("#start-button").click(function(){this.blur();if(started==1){return false}var a=0;if(!validURL("#url")){$("#main-border").removeClass("main-border").addClass("main-border-wrong");a=1}else{$("#main-border").removeClass("main-border-wrong").addClass("main-border")}if(a){return false}started=1;startConvert($("#url").val());return false});$("#main-form input").focus(function(){if(pImgFor!=conversionID){reloadPImg()}});reloadPImg();setTimeout(function(){addthis.init()},1000)});function startConvert(a){allowProcessing=1;progressOn();x_ajax({req:{url:"convert/"+sessionID+"/"+conversionID,type:"GET",data:{url:a,g:$("input[name=g]").is(":checked")+0,l:$("input[name=l]").is(":checked")+0,q:$("input[name=q]").is(":checked")+0,b:$("input[name=b]").is(":checked")+0,j:$("input[name=j]").is(":checked")+0},dataType:"json"},onData:function(b){progressOn();allowProcessing=b.pid;getStatus(b.pid)},onError:function(b){progressOff();if(typeof(b.details)=="string"){x_prettyError(b.details)}else{x_prettyError("Unexpected error.")}},onFail:function(){progressOff();x_prettyError("Unexpected error.")}})}function getStatus(a){progressOn();x_ajax({req:{url:"status/"+sessionID+"/"+conversionID+"/"+a,type:"GET",dataType:"json"},onData:function(b){if(allowProcessing==b.pid){allowProcessing=null;$("#progress-bar").progressbar("option","value",b.progress);setTimeout(function(){progressOff();$("#url").val("")},1000);goDownload(b.file)}},onProcessing:function(b){if(b.progress>1&&allowProcessing==b.pid){$("#progress-bar").progressbar("option","value",b.progress)}},onError:function(b){if(allowProcessing==b.pid){if(retries<2){retries++;conversionID=randomString();$("#progress-block .main-label").html("Error... Attempt #"+(retries+1)+"...");startConvert($("#url").val())}else{progressOff();if(typeof(b.details)=="string"){x_prettyError(b.details)}else{x_prettyError("Unexpected error.")}}}},onFail:function(){progressOff();x_prettyError("Unexpected error.")},silent:1})}function goDownload(a){var b="download/"+sessionID+"/"+conversionID+"?rnd="+Math.random();x_prettyAlert("Download the Result","<div style='margin-top: -10px; text-align: center;'><a class='download-link' href='"+b+"'><img src='images/download-pdf.png' border='0'><br>"+a+"</a></div>")}function progressOn(){$("#start-button").hide();$("#start-button-progress").show();$("#main-block").hide();$("#progress-block").show();if(progress<0){$("#progress-bar").progressbar({value:1})}else{$("#progress-bar").progressbar("option","value",1)}progress=1}function progressOff(){allowProcessing=null;$("#progress-block .main-label").html("Converting...");$("#start-button-progress").hide();$("#start-button").show();$("#progress-bar").progressbar("option","value",0);$("#progress-block").hide();$("#main-block").show();progress=0;started=0;retries=0;conversionID=randomString()}function centerWrapper(){var c=$("body").height();var a=$("#wrapper").height();var b=Math.round(((c-a)/2)*0.5);if(b<0){b=0}$("#wrapper").css("top",b+"px")}function reloadPImg(){$("<img>").attr({src:"images/button-2-progress.gif?"+conversionID}).load(function(){$("#start-button-progress img").remove();$(this).appendTo("#start-button-progress");pImgFor=conversionID})};